<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0 user-scalable=no">
  <meta name="format-detection" content="telephone=yes">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="renderer" content="webkit">
  <meta http-equiv="Expires" content="0">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Cache-control" content="no-cache">
  <meta http-equiv="Cache" content="no-cache">
  <title>Switch</title>
  <link rel="stylesheet" href="../../css/num_keyboard.css" type="text/css">

  <style>
    @import "../../css/styles.css";

    .btn_disabled {
      color: #8c8c8c;
    }

  </style>
</head>
<body class="all-bg">

<div class="log-content">
  <div class="log-bg"></div>
</div>

<div class="new-panel">
  <div style="width: 50%">
    <br>
    <br>
    <br>
    <div class="new-panel-title  phone-area">
      Please Select one of the following options
    </div>
    <div class="new-panel-title  code-area hidden">
      Enter Verification Code
    </div>
    <br>
    <br>
    <div class="new-panel-content phone-area">Current Transanction Limit 10,000 USD</div>
    <div class="new-panel-content code-area hidden">Please enter the 6-Digit verification code sent to your mobile</div>
  </div>
  <div id="loadingArea" style="width: 50%;margin-top: 86px">
    <!--    <div class="info-content-big">-->
    <!--      <div id="currentCoin">&ensp;BTC</div>-->
    <!--    </div>-->
    <input type="text" id="my_input" class="mykeyboard" style="height: 80px;
    margin-bottom: 10px;
    width: 430px;
    font-size: 40px;"/>
  </div>
</div>


<div class="bottom-contact">
  <!--  <div class="merchant_hotLine">100</div>-->
  <div class="merchant_mail">www.huanghui-it.com</div>
</div>
<div class="to_home_div">
  <div class="to_cancel_btn" onclick="toHome()">Cancel</div>
  <div class="to_home_label"></div>
</div>
<script type="text/javascript" src="../../js/common/jquery.min.js"></script>
<script type="text/javascript" src="../../js/common/num_keyboard.js"></script>
<script type="text/javascript" src="../../js/common/toast.script.js"></script>
<script type="text/javascript" src="../../js/common/language.js"></script>
<script type="text/javascript" src="../../js/transaction/price.js"></script>
<script type="text/javascript" src="../../js/transaction/common.js"></script>
<script type="text/javascript" src="../../js/transaction/CommonInterface.js"></script>
<script type="text/javascript" src="../../js/transaction/toError.js"></script>


<script type="text/javascript">
  //默认出现位置在绑定元素的下方出现，如果底部距离不足，则在绑定元素的上部出现
  $('#my_input').mykeyboard();

  var merchantObj = getMerchant();
  var btcPrice = 0, btcExchangeRate = 0;
  var phoneNum, msgCode;//电话号,验证码

  // 点击完成
  function toSwitch() {
    var coin = "btc";
    localStorage.setItem("currentCoin", coin);
    localStorage.setItem("balance", btcPrice);
    localStorage.setItem("exchangeRate", btcExchangeRate);
    if (merchantObj) {
      window.location.href = "switch.html";
    } else {
      toError("merchat setting is required")
    }
  }


  function getIndexBalance(coin) {
    var merchantObj = getMerchant();
    var newBalance = merchantObj['cryptoSettings'][coin].price;
    if (!newBalance) {
      var resp = JSON.parse(window.front.queryMarketPrice(coin));
      if (resp.code == "00") {
        newBalance = resp.price;
        if (coin == "btc") {
          btcPrice = resp.price;
          btcExchangeRate = resp.exchangeRate;
        }
        if (coin == "eth") {
          ethPrice = resp.price;
          ethExchangeRate = resp.exchangeRate;
        }
      }
    }
  }


  /**
   * 初始化
   */
  window.onload = function () {
    getIndexBalance('btc');
  };


  //发送验证码
  function sendMsg() {
    phoneNum = $('#my_input').val();
    console.log(merchantObj.terminalNo +"(" +phoneNum+")调用发送短信验证码");
    //发送验证码
    msgCode = window.webTimer.sendMsg(merchantObj.terminalNo,phoneNum);
    if (msgCode && msgCode.length == 6) {
      showCodeMsg();
      checkMsg();
    } else {
      showWarn("Failed to send verification code, please try again later");
    }
  }

  //校验验证码
  function checkMsg() {
    var inputCode = $('#my_input').val();
    if (inputCode == msgCode) {
      toSwitch();
    } else {
      showWarn("Invalid verification code");
    }
  }

  //
  function showCodeMsg() {
    $('#my_input').val("");
    $('.phone-area').addClass('hidden');
    $('.code-area').removeClass('hidden');
    $('#continue-btn').attr("onclick", "toSwitch()");
  }

</script>
</body>

</html>
